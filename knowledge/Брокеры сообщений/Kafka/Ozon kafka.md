Какие есть задачи у брокера? Он должен:
1. Принимать сообщений
2. Хранить сообщений
3. Отдавать сообщения

Брокеры можно объединить в кластер, для большей отказаустойчивости
![[Pasted image 20240801221520.png]]

Чтобы управлять кластером, вместе с кафкой подниматся ZooKeeper
![[Pasted image 20240801221653.png]]

Кворум - минимальное кол-во элементов в кластере
![[Pasted image 20240801221856.png]]

#### Сообщения
![[Pasted image 20240801222019.png]]

Correlation_id - мы можем установить индификатор, который свяжет цепочку вызовов на producer что было до того, как мне скинули это сообщение в кафку. И цепочку consumer, что случилось после того, как мы эту цепочку обработали.

![[Pasted image 20240801222610.png]]

Пример с кодом. Сверху, просто отправка и kafka решит в какую партицию направить сообщение. Либо можно указать в какую именно портицию нам нужно отправить, как показано внизу
![[Pasted image 20240801222833.png]]

Партиции хранятся в папках со своими файлами
![[Pasted image 20240801222941.png]]

#### Producer
![[Гарантия доставки]]

Как создавать producer
![[Pasted image 20240801225140.png]]

![[Pasted image 20240801225404.png]]

#### Consumer
Consumer сам приходит к кафке в партиции и спрашивет, если ли у неё новые сообщения. Тут работает pull модель, в отличии от RabbitMQ, в котором работает push модель, он сам пушит consumer-а о новых сообщениях

![[Pasted image 20240801230039.png]]

Consumer можно объединять в группы, и параллелить чтение из партиций. Но отдавать из одной партий в несколько consumer мы не можем, потому что нельзя обеспечить последовательность обработки сообщений в рамках 1-ой партиции

![[Pasted image 20240801230153.png]]
![[Pasted image 20240801230334.png]]
![[Pasted image 20240801230408.png]]
![[Pasted image 20240801230429.png]]

Пример с кодом
![[Pasted image 20240801230619.png]]

**Важно**
В consumer-group у каждого отдельного consumer должна быть одинаковая настройка для AutoOffsetReset, иначе вылетит ошибка

Как запрашивать сообщения
![[Pasted image 20240801231025.png]]

Чтение с какого-то офсета
![[Pasted image 20240801231153.png]]

#### Что почитать
![[Pasted image 20240801231232.png]]