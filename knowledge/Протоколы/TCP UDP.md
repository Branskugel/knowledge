**TCP и UDP: Сравнение транспортных протоколов**  
TCP (Transmission Control Protocol) и UDP (User Datagram Protocol) — это два основных транспортных протокола в сетях на базе IP. Они служат для передачи данных между приложениями, но принципиально различаются по своей логике работы, надежности и сценариям использования.

---

### **1. Основные различия**

| **Критерий**       | **TCP**                                  | **UDP**                                  |
|---------------------|------------------------------------------|------------------------------------------|
| **Соединение**      | Устанавливает соединение (handshake).    | Без установки соединения.                |
| **Надежность**      | Гарантирует доставку и порядок пакетов.  | Нет гарантий доставки или порядка.       |
| **Контроль ошибок** | Автоматически повторяет потерянные пакеты. | Нет повторной отправки.                 |
| **Скорость**        | Медленнее из-за накладных расходов.      | Быстрее, меньше задержек.               |
| **Заголовок**       | 20–60 байт (сложная структура).          | 8 байт (минимальный заголовок).         |
| **Использование**   | HTTP, HTTPS, FTP, Email.                 | Видеостримы, VoIP, онлайн-игры, DNS.    |

---

### **2. TCP: Надежность превыше всего**  
- **Установка соединения** («трёхстороннее рукопожатие»):  
  1. Клиент → Сервер: `SYN` (запрос на соединение).  
  2. Сервер → Клиент: `SYN-ACK` (подтверждение).  
  3. Клиент → Сервер: `ACK` (финальное подтверждение).  

- **Особенности:**  
  - **Последовательность пакетов:** Данные приходят в том порядке, в котором были отправлены.  
  - **Контроль перегрузок:** Динамически регулирует скорость передачи, чтобы избежать перегрузки сети.  
  - **Подтверждение доставки (ACK):** Каждый пакет требует подтверждения от получателя.  

- **Примеры:**  
  - Загрузка файла через браузер (потеря пакетов недопустима).  
  - Отправка электронного письма (SMTP).  

---

### **3. UDP: Скорость и простота**  
- **Без установки соединения:** Пакеты отправляются без предварительного согласования.  
- **Особенности:**  
  - **Нет гарантий:** Пакеты могут теряться, дублироваться или приходить в неправильном порядке.  
  - **Минимальные задержки:** Идеален для приложений, где важна скорость, а не надежность.  
  - **Мультикаст и броадкаст:** Поддерживает групповую рассылку данных.  

- **Примеры:**  
  - Онлайн-игры (потеря пакета позиции игрока не критична, но задержка разрушает опыт).  
  - Видеоконференции (лучше потерять часть кадров, чем зависнуть).  
  - DNS-запросы (быстрый однократный обмен данными).  

---

### **4. Реальные сценарии выбора**  

#### **Когда использовать TCP?**  
- **Передача важных данных:** Файлы, документы, веб-страницы.  
- **Длительные сессии:** SSH-подключения, удалённые рабочие столы.  
- **Транзакции:** Банковские операции, онлайн-платежи.  

#### **Когда использовать UDP?**  
- **Стриминг в реальном времени:** Twitch, Zoom, Skype.  
- **Многопользовательские игры:** Fortnite, Counter-Strike.  
- **IoT-устройства:** Датчики, отправляющие частые, но некритичные данные.  

---

### **5. Технические детали**  

#### **Заголовок TCP**  
Содержит поля для:  
- Портов отправителя и получателя.  
- Номера последовательности и подтверждения.  
- Флаги (SYN, ACK, RST и др.).  
- Размер окна (контроль перегрузок).  

#### **Заголовок UDP**  
Включает только:  
- Порты отправителя и получателя.  
- Длину пакета и контрольную сумму.  

---

### **6. Исключения и гибридные подходы**  
- **HTTP/3:** Новейшая версия HTTP работает поверх QUIC (протокол на базе UDP), чтобы уменьшить задержки.  
- **TCP для стриминга:** Некоторые приложения (например, YouTube) используют TCP, жертвуя скоростью ради надежности, но компенсируют это буферизацией.  

---

### **Заключение**  
- **TCP** — это «надёжный почтальон», который гарантирует, что каждое письмо дойдёт до адресата в правильном порядке.  
- **UDP** — это «экспресс-доставка», которая быстра, но может потерять посылку.  

Выбор между ними зависит от требований приложения:  
- **Нужна гарантия целостности данных?** → TCP.  
- **Важна минимальная задержка?** → UDP.  

Понимание этих протоколов позволяет проектировать эффективные сетевые приложения, учитывающие компромиссы между скоростью и надёжностью.